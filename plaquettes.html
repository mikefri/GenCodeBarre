<!DOCTYPE html>
<html lang="fr">

<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>GÃ©nÃ©rateur de Planches - Standalone</title>
Â  Â  <meta name="theme-color" content="#0f172a">

Â  Â  <link rel="preconnect" href="https://fonts.googleapis.com">
Â  Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

Â  Â  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.1/qrcode.min.js"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

Â  Â  <style>
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  /* Palette Pro SaaS (Slate) */
Â  Â  Â  Â  Â  Â  --bg-app: #0f172a;
Â  Â  Â  Â  Â  Â  --bg-sidebar: #1e293b;
Â  Â  Â  Â  Â  Â  --bg-panel: #334155;

Â  Â  Â  Â  Â  Â  --border-subtle: #334155;
Â  Â  Â  Â  Â  Â  --border-focus: #3b82f6;

Â  Â  Â  Â  Â  Â  --text-main: #f8fafc;
Â  Â  Â  Â  Â  Â  --text-secondary: #94a3b8;

Â  Â  Â  Â  Â  Â  --primary: #3b82f6;
Â  Â  Â  Â  Â  Â  --primary-hover: #2563eb;

Â  Â  Â  Â  Â  Â  --success: #10b981;
Â  Â  Â  Â  Â  Â  --danger: #ef4444;

Â  Â  Â  Â  Â  Â  --radius: 6px;
Â  Â  Â  Â  }

Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
Â  Â  Â  Â  Â  Â  background-color: var(--bg-app);
Â  Â  Â  Â  Â  Â  color: var(--text-main);
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  height: 100vh;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- SIDEBAR (GAUCHE) --- */
Â  Â  Â  Â  .sidebar {
Â  Â  Â  Â  Â  Â  width: 320px;
Â  Â  Â  Â  Â  Â  background: var(--bg-sidebar);
Â  Â  Â  Â  Â  Â  border-right: 1px solid var(--border-subtle);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  Â  Â  flex-shrink: 0;
Â  Â  Â  Â  Â  Â  box-shadow: 4px 0 24px rgba(0, 0, 0, 0.2);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- ONGLETS --- */
Â  Â  Â  Â  .tabs-nav {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  background: #0f172a;
Â  Â  Â  Â  Â  Â  padding: 3px;
Â  Â  Â  Â  Â  Â  border-radius: var(--radius);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--border-subtle);
Â  Â  Â  Â  }

Â  Â  Â  Â  .tab-btn {
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  padding: 8px;
Â  Â  Â  Â  Â  Â  background: transparent;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  color: var(--text-secondary);
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  transition: all 0.15s ease;
Â  Â  Â  Â  }

Â  Â  Â  Â  .tab-btn:hover {
Â  Â  Â  Â  Â  Â  color: #fff;
Â  Â  Â  Â  }

Â  Â  Â  Â  .tab-btn.active {
Â  Â  Â  Â  Â  Â  background: var(--bg-panel);
Â  Â  Â  Â  Â  Â  color: #fff;
Â  Â  Â  Â  Â  Â  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
Â  Â  Â  Â  }

Â  Â  Â  Â  .sidebar-header {
Â  Â  Â  Â  Â  Â  padding: 20px 24px;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid var(--border-subtle);
Â  Â  Â  Â  Â  Â  background: var(--bg-sidebar);
Â  Â  Â  Â  }

Â  Â  Â  Â  .app-title {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  color: #fff;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  font-size: 1.1rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .sidebar-content {
Â  Â  Â  Â  Â  Â  padding: 24px;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  gap: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Form Elements */
Â  Â  Â  Â  .control-group {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  gap: 6px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .control-group label {
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  font-size: 0.8rem;
Â  Â  Â  Â  Â  Â  color: var(--text-secondary);
Â  Â  Â  Â  }

Â  Â  Â  Â  input[type="number"],
Â  Â  Â  Â  select {
Â  Â  Â  Â  Â  Â  padding: 10px 12px;
Â  Â  Â  Â  Â  Â  border-radius: var(--radius);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--border-subtle);
Â  Â  Â  Â  Â  Â  background: var(--bg-app);
Â  Â  Â  Â  Â  Â  color: #fff;
Â  Â  Â  Â  Â  Â  outline: none;
Â  Â  Â  Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  }

Â  Â  Â  Â  input[type="number"]:focus,
Â  Â  Â  Â  select:focus {
Â  Â  Â  Â  Â  Â  border-color: var(--primary);
Â  Â  Â  Â  }

Â  Â  Â  Â  .divider {
Â  Â  Â  Â  Â  Â  border: 0;
Â  Â  Â  Â  Â  Â  border-top: 1px solid var(--border-subtle);
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  margin: 10px 0;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Import Zone */
Â  Â  Â  Â  .drop-zone {
Â  Â  Â  Â  Â  Â  border: 1px dashed var(--border-subtle);
Â  Â  Â  Â  Â  Â  background: var(--bg-app);
Â  Â  Â  Â  Â  Â  border-radius: var(--radius);
Â  Â  Â  Â  Â  Â  padding: 25px 15px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  color: var(--text-secondary);
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  }

Â  Â  Â  Â  .drop-zone:hover {
Â  Â  Â  Â  Â  Â  border-color: var(--primary);
Â  Â  Â  Â  Â  Â  color: var(--primary);
Â  Â  Â  Â  Â  Â  background: rgba(59, 130, 246, 0.05);
Â  Â  Â  Â  }

Â  Â  Â  Â  .status-card {
Â  Â  Â  Â  Â  Â  background: #064e3b;
Â  Â  Â  Â  Â  Â  border: 1px solid #059669;
Â  Â  Â  Â  Â  Â  border-radius: var(--radius);
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Grid Settings */
Â  Â  Â  Â  .grid-settings {
Â  Â  Â  Â  Â  Â  background: var(--bg-panel);
Â  Â  Â  Â  Â  Â  padding: 12px;
Â  Â  Â  Â  Â  Â  border-radius: var(--radius);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  Â  Â  border: 1px solid var(--border-subtle);
Â  Â  Â  Â  }

Â  Â  Â  Â  .grid-row {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .grid-col {
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Actions Footer */
Â  Â  Â  Â  .sidebar-footer {
Â  Â  Â  Â  Â  Â  padding: 15px 24px;
Â  Â  Â  Â  Â  Â  border-top: 1px solid var(--border-subtle);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  Â  Â  background: var(--bg-sidebar);
Â  Â  Â  Â  }

Â  Â  Â  Â  button.action-btn {
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  border-radius: var(--radius);
Â  Â  Â  Â  Â  Â  border: 1px solid transparent;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-print {
Â  Â  Â  Â  Â  Â  background: var(--text-main);
Â  Â  Â  Â  Â  Â  color: var(--bg-app);
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-download {
Â  Â  Â  Â  Â  Â  background: transparent;
Â  Â  Â  Â  Â  Â  color: var(--text-main);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--border-subtle);
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-danger {
Â  Â  Â  Â  Â  Â  background: rgba(239, 68, 68, 0.1);
Â  Â  Â  Â  Â  Â  color: var(--danger);
Â  Â  Â  Â  Â  Â  font-size: 0.8rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- MAIN PREVIEW (DROITE) --- */
Â  Â  Â  Â  .main-content {
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  background: #020617;
Â  Â  Â  Â  Â  Â  background-image: radial-gradient(#1e293b 1px, transparent 1px);
Â  Â  Â  Â  Â  Â  background-size: 20px 20px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }

Â  Â  Â  Â  .toolbar-preview {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 15px;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  transform: translateX(-50%);
Â  Â  Â  Â  Â  Â  background: rgba(15, 23, 42, 0.8);
Â  Â  Â  Â  Â  Â  backdrop-filter: blur(4px);
Â  Â  Â  Â  Â  Â  padding: 8px 16px;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  border: 1px solid var(--border-subtle);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 15px;
Â  Â  Â  Â  Â  Â  z-index: 50;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-size: 0.8rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .preview-scroll-wrapper {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  overflow: auto;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: flex-start;
Â  Â  Â  Â  Â  Â  padding: 60px 40px;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  }

Â  Â  Â  Â  .sheet-transform-layer {
Â  Â  Â  Â  Â  Â  transform-origin: top center;
Â  Â  Â  Â  Â  Â  transition: transform 0.2s ease-out;
Â  Â  Â  Â  Â  Â  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            /* Ajout important pour le multi-page: doit permettre le flex-direction column */
            display: flex; 
            flex-direction: column;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* FEUILLE */
Â  Â  Â  Â  .sheet {
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  color: black;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  width: 210mm;
Â  Â  Â  Â  Â  Â  height: 297mm;
Â  Â  Â  Â  Â  Â  /* A4 Portrait Default */

Â  Â  Â  Â  Â  Â  /* Variables CSS Grille - Seront dÃ©finies par JS */
Â  Â  Â  Â  Â  Â  padding-top: var(--mt, 4.5mm); /* Valeurs par dÃ©faut pour l'aperÃ§u */
Â  Â  Â  Â  Â  Â  padding-left: var(--ml, 5mm);
Â  Â  Â  Â  Â  Â  padding-right: var(--ml, 5mm);
            margin-bottom: 20mm; /* Espace entre les feuilles en mode AperÃ§u */
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Grille CSS */
Â  Â  Â  Â  .grid-container {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(var(--cols, 3), 1fr);
Â  Â  Â  Â  Â  Â  grid-template-rows: repeat(var(--rows, 8), var(--lh, 36mm));
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: auto;
Â  Â  Â  Â  Â  Â  justify-content: start;
Â  Â  Â  Â  Â  Â  align-content: start;
Â  Â  Â  Â  }

Â  Â  Â  Â  .barcode-cell {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  border: 1px dashed rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  Â  Â  /* Guides visuels */
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  Â  Â  padding: 2px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Impression */
Â  Â  Â  Â  @media print {

Â  Â  Â  Â  Â  Â  @page {
Â  Â  Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .sidebar,
Â  Â  Â  Â  Â  Â  .toolbar-preview {
Â  Â  Â  Â  Â  Â  Â  Â  display: none !important;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .main-content,
Â  Â  Â  Â  Â  Â  .preview-scroll-wrapper,
Â  Â  Â  Â  Â  Â  .sheet-transform-layer {
Â  Â  Â  Â  Â  Â  Â  Â  display: block !important;
Â  Â  Â  Â  Â  Â  Â  Â  position: static !important;
Â  Â  Â  Â  Â  Â  Â  Â  width: auto !important;
Â  Â  Â  Â  Â  Â  Â  Â  height: auto !important;
Â  Â  Â  Â  Â  Â  Â  Â  overflow: visible !important;
Â  Â  Â  Â  Â  Â  Â  Â  transform: none !important;
Â  Â  Â  Â  Â  Â  Â  Â  margin: 0 !important;
Â  Â  Â  Â  Â  Â  Â  Â  padding: 0 !important;
Â  Â  Â  Â  Â  Â  Â  Â  background: white !important;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .sheet {
Â  Â  Â  Â  Â  Â  Â  Â  margin: 0 !important; /* Retire la marge d'aperÃ§u pour l'impression */
Â  Â  Â  Â  Â  Â  Â  Â  box-shadow: none !important;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .barcode-cell {
Â  Â  Â  Â  Â  Â  Â  Â  border: none !important;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  /* Cacher les guides Ã  l'impression */
Â  Â  Â  Â  }
Â  Â  </style>
</head>

<body>

Â  Â  <aside class="sidebar">
Â  Â  Â  Â  <div class="sidebar-header">
Â  Â  Â  Â  Â  Â  <div class="app-title">Gestion Ã‰tiquettes</div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="sidebar-content">

Â  Â  Â  Â  Â  Â  <div class="tabs-nav">
Â  Â  Â  Â  Â  Â  Â  Â  <a href="https://mikefri.github.io/GenCodeBarre" class="tab-btn" id="btn-tab-tools">Ã‰diteur</a>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="tab-btn active" id="btn-tab-tools" data-target="tab-tools">DonnÃ©es</button>
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  <div class="control-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label>1. Source de DonnÃ©es (Excel)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="drop-zone" id="dropZone">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 1.5rem; margin-bottom: 5px;">ðŸ“‚ Import .xlsx</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 0.75rem; opacity: 0.6;">Colonne A uniquement</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="excelInput" class="hidden-input" accept=".xlsx, .xls" style="display:none">
Â  Â  Â  Â  Â  Â  Â  Â  </label>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="importStatus" class="status-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="color: #fff; font-weight: 600; font-size: 0.8rem;">Import OK</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="importCount" style="color: #a7f3d0; font-size: 0.75rem;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <button id="clearDataBtn" class="action-btn btn-danger" style="display:none;">Effacer</button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="divider"></div>

Â  Â  Â  Â  Â  Â  <div class="control-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label>2. Type de Code</label>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="codeType">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="CODE128">Code 128</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="EAN13">EAN-13</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="QRCODE">QR Code</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="control-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label>3. Configuration Grille</label>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <select id="gridPresetSelect" style="margin-bottom: 10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="" selected disabled>SÃ©lectionner un ModÃ¨le prÃ©dÃ©fini...</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid-settings">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid-col">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Marge Haut (mm)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="marginTop" value="0.5" step="0.5">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid-col">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Marge G (mm)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="marginLeft" value="0" step="0.5">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid-col">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Colonnes</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="nbCols" value="3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid-col">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Lignes</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="nbRows" value="8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid-col">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>H. Ã‰tiquette (mm)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="rowHeight" value="36">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid-col">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Ã‰chelle Code</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="codeScale" value="1" step="0.1" min="0.5" max="3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="sidebar-footer">
Â  Â  Â  Â  Â  Â  <button class="action-btn btn-print" onclick="window.print()">Imprimer</button>
Â  Â  Â  Â  Â  Â  <button class="action-btn btn-download" id="downloadBtn">TÃ©lÃ©charger PNG</button>
Â  Â  Â  Â  </div>
Â  Â  </aside>

Â  Â  <main class="main-content">
Â  Â  Â  Â  <div class="toolbar-preview">
Â  Â  Â  Â  Â  Â  <span>Zoom AperÃ§u</span>
Â  Â  Â  Â  Â  Â  <input type="range" id="zoomSlider" min="0.4" max="1.5" step="0.1" value="0.7">
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="preview-scroll-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="sheet-transform-layer" id="sheetLayer" style="transform: scale(0.7);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </main>

Â  Â  <script>
Â  Â  Â  Â  const refs = {
Â  Â  Â  Â  Â  Â  excelInput: document.getElementById('excelInput'),
Â  Â  Â  Â  Â  Â  dropZone: document.getElementById('dropZone'),
Â  Â  Â  Â  Â  Â  importStatus: document.getElementById('importStatus'),
Â  Â  Â  Â  Â  Â  importCount: document.getElementById('importCount'),
Â  Â  Â  Â  Â  Â  clearBtn: document.getElementById('clearDataBtn'),
Â  Â  Â  Â  Â  Â  downloadBtn: document.getElementById('downloadBtn'),

Â  Â  Â  Â  Â  Â  // gridContainer, pageSheet NE SONT PLUS UTILISÃ‰S COMME RÃ‰FÃ‰RENCES GLOBALES
Â  Â  Â  Â  Â  Â  sheetLayer: document.getElementById('sheetLayer'),
Â  Â  Â  Â  Â  Â  zoomSlider: document.getElementById('zoomSlider'),

Â  Â  Â  Â  Â  Â  // Inputs Config
Â  Â  Â  Â  Â  Â  codeType: document.getElementById('codeType'),
Â  Â  Â  Â  Â  Â  marginTop: document.getElementById('marginTop'),
Â  Â  Â  Â  Â  Â  marginLeft: document.getElementById('marginLeft'),
Â  Â  Â  Â  Â  Â  nbCols: document.getElementById('nbCols'),
Â  Â  Â  Â  Â  Â  nbRows: document.getElementById('nbRows'),
Â  Â  Â  Â  Â  Â  rowHeight: document.getElementById('rowHeight'),
Â  Â  Â  Â  Â  Â  codeScale: document.getElementById('codeScale'),

Â  Â  Â  Â  Â  Â  gridPresetSelect: document.getElementById('gridPresetSelect')Â 
Â  Â  Â  Â  };

Â  Â  Â  Â  let appData = []; // Stockage des codes

Â  Â  Â  Â  // --- DÃ‰FINITION DES PRESETS DE GRILLE ---
Â  Â  Â  Â  const gridPresets = [
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  name: "Planche de 24 (3x8 - 36mm)",
Â  Â  Â  Â  Â  Â  Â  Â  marginTop: 0.5,
Â  Â  Â  Â  Â  Â  Â  Â  marginLeft: 0,
Â  Â  Â  Â  Â  Â  Â  Â  nbCols: 3,
Â  Â  Â  Â  Â  Â  Â  Â  nbRows: 8,
Â  Â  Â  Â  Â  Â  Â  Â  rowHeight: 36,
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  name: "2x4 (Grands - 65mm)",
Â  Â  Â  Â  Â  Â  Â  Â  marginTop: 10,
Â  Â  Â  Â  Â  Â  Â  Â  marginLeft: 10,
Â  Â  Â  Â  Â  Â  Â  Â  nbCols: 2,
Â  Â  Â  Â  Â  Â  Â  Â  nbRows: 4,
Â  Â  Â  Â  Â  Â  Â  Â  rowHeight: 65,
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  name: "4x10 (Petits - 25mm)",
Â  Â  Â  Â  Â  Â  Â  Â  marginTop: 5,
Â  Â  Â  Â  Â  Â  Â  Â  marginLeft: 5,
Â  Â  Â  Â  Â  Â  Â  Â  nbCols: 4,
Â  Â  Â  Â  Â  Â  Â  Â  nbRows: 10,
Â  Â  Â  Â  Â  Â  Â  Â  rowHeight: 25,
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  ];
Â  Â  Â  Â  // --- FIN PRESETS ---


Â  Â  Â  Â  // --- GESTION DU ZOOM ---
Â  Â  Â  Â  refs.zoomSlider.addEventListener('input', (e) => {
Â  Â  Â  Â  Â  Â  refs.sheetLayer.style.transform = `scale(${e.target.value})`;
Â  Â  Â  Â  });


Â  Â  Â  Â  // --- GESTION DES PRESETS SELECTIONNÃ‰S ---
Â  Â  Â  Â  function populatePresets() {
Â  Â  Â  Â  Â  Â  gridPresets.forEach((preset, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  Â  Â  Â  option.value = index;
Â  Â  Â  Â  Â  Â  Â  Â  option.textContent = preset.name;
Â  Â  Â  Â  Â  Â  Â  Â  refs.gridPresetSelect.appendChild(option);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  // SÃ©lectionne le premier preset par dÃ©faut au dÃ©marrage
Â  Â  Â  Â  Â  Â  refs.gridPresetSelect.value = 0;
Â  Â  Â  Â  Â  Â  applyPreset(0); 
Â  Â  Â  Â  }

Â  Â  Â  Â  // Fonction pour appliquer un preset par index
Â  Â  Â  Â  function applyPreset(selectedIndex) {
Â  Â  Â  Â  Â  Â  const preset = gridPresets[selectedIndex];

Â  Â  Â  Â  Â  Â  refs.marginTop.value = preset.marginTop;
Â  Â  Â  Â  Â  Â  refs.marginLeft.value = preset.marginLeft;
Â  Â  Â  Â  Â  Â  refs.nbCols.value = preset.nbCols;
Â  Â  Â  Â  Â  Â  refs.nbRows.value = preset.nbRows;
Â  Â  Â  Â  Â  Â  refs.rowHeight.value = preset.rowHeight;

Â  Â  Â  Â  Â  Â  renderBarcodes(); // Mettre Ã  jour le rendu
Â  Â  Â  Â  }


Â  Â  Â  Â  refs.gridPresetSelect.addEventListener('change', (e) => {
Â  Â  Â  Â  Â  Â  const selectedIndex = e.target.value;
Â  Â  Â  Â  Â  Â  if (selectedIndex !== "" && selectedIndex !== null) {
Â  Â  Â  Â  Â  Â  Â  Â  applyPreset(selectedIndex);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // Listener sur tous les inputs de config pour re-rendu immÃ©diat
Â  Â  Â  Â  [refs.marginTop, refs.marginLeft, refs.nbCols, refs.nbRows, refs.rowHeight, refs.codeScale, refs.codeType]
Â  Â  Â  Â  Â  Â  .forEach(el => el.addEventListener('input', () => {
Â  Â  Â  Â  Â  Â  Â  Â  // Retire la sÃ©lection de preset si l'utilisateur modifie manuellement
Â  Â  Â  Â  Â  Â  Â  Â  refs.gridPresetSelect.value = "";Â 
Â  Â  Â  Â  Â  Â  Â  Â  renderBarcodes();
Â  Â  Â  Â  Â  Â  }));
Â  Â  Â  Â  // --- FIN PRESETS LOGIQUE ---


Â  Â  Â  Â  // NOUVELLE FONCTION: Applique les styles CSS de la grille Ã  un Ã©lÃ©ment de feuille
Â  Â  Â  Â  function applySheetStyles(sheetElement) {
Â  Â  Â  Â  Â  Â  const style = sheetElement.style;
Â  Â  Â  Â  Â  Â  style.setProperty('--mt', refs.marginTop.value + 'mm');
Â  Â  Â  Â  Â  Â  style.setProperty('--ml', refs.marginLeft.value + 'mm');
Â  Â  Â  Â  Â  Â  style.setProperty('--cols', refs.nbCols.value);
Â  Â  Â  Â  Â  Â  style.setProperty('--rows', refs.nbRows.value);
Â  Â  Â  Â  Â  Â  style.setProperty('--lh', refs.rowHeight.value + 'mm');
Â  Â  Â  Â  }


Â  Â  Â  Â  // --- RENDU MULTI-PAGES DES CODES ---
Â  Â  Â  Â  function renderBarcodes() {
Â  Â  Â  Â  Â  Â  refs.sheetLayer.innerHTML = ''; // VIDE TOUTES LES PAGES PRÃ‰CÃ‰DENTES

Â  Â  Â  Â  Â  Â  const nbCols = parseInt(refs.nbCols.value);
Â  Â  Â  Â  Â  Â  const nbRows = parseInt(refs.nbRows.value);
Â  Â  Â  Â  Â  Â  const maxPerSheet = nbCols * nbRows;
Â  Â  Â  Â  Â  Â  const scale = parseFloat(refs.codeScale.value);

Â  Â  Â  Â  Â  Â  if (appData.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  // Gestion du mode dÃ©mo si aucune donnÃ©e n'est importÃ©e
Â  Â  Â  Â  Â  Â  Â  Â  const demoSheet = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  demoSheet.className = 'sheet';
Â  Â  Â  Â  Â  Â  Â  Â  applySheetStyles(demoSheet);

Â  Â  Â  Â  Â  Â  Â  Â  const demoGridContainer = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  demoGridContainer.className = 'grid-container';

Â  Â  Â  Â  Â  Â  Â  Â  createCell("EXEMPLE", scale, demoGridContainer, true);

Â  Â  Â  Â  Â  Â  Â  Â  demoSheet.appendChild(demoGridContainer);
Â  Â  Â  Â  Â  Â  Â  Â  refs.sheetLayer.appendChild(demoSheet);
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Logique Multi-Pages
Â  Â  Â  Â  Â  Â  for (let i = 0; i < appData.length; i += maxPerSheet) {
Â  Â  Â  Â  Â  Â  Â  Â  // 1. DÃ©couper les donnÃ©es pour la page actuelle
Â  Â  Â  Â  Â  Â  Â  Â  const pageData = appData.slice(i, i + maxPerSheet);
Â  Â  Â  Â  Â  Â  Â  Â  const sheetIndex = Math.floor(i / maxPerSheet) + 1; // NumÃ©ro de page

Â  Â  Â  Â  Â  Â  Â  Â  // 2. CrÃ©er les Ã©lÃ©ments de la nouvelle page (planche)
Â  Â  Â  Â  Â  Â  Â  Â  const newSheet = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  newSheet.className = 'sheet';
Â  Â  Â  Â  Â  Â  Â  Â  newSheet.id = `pageSheet-${sheetIndex}`;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Appliquer les styles du preset Ã  cette feuille spÃ©cifique
Â  Â  Â  Â  Â  Â  Â  Â  applySheetStyles(newSheet); 

Â  Â  Â  Â  Â  Â  Â  Â  const newGridContainer = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  newGridContainer.className = 'grid-container';

Â  Â  Â  Â  Â  Â  Â  Â  // 3. Remplir la grille avec les codes de cette page
Â  Â  Â  Â  Â  Â  Â  Â  pageData.forEach(code => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createCell(code, scale, newGridContainer);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  newSheet.appendChild(newGridContainer);
Â  Â  Â  Â  Â  Â  Â  Â  refs.sheetLayer.appendChild(newSheet);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // Fonction modifiÃ©e pour accepter le conteneur cible
Â  Â  Â  Â  function createCell(text, scale, targetContainer, isDemo = false) {
Â  Â  Â  Â  Â  Â  const cell = document.createElement('div');
Â  Â  Â  Â  Â  Â  cell.className = 'barcode-cell';
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (isDemo) {
Â  Â  Â  Â  Â  Â  Â  Â  cell.style.opacity = "0.3";
Â  Â  Â  Â  Â  Â  Â  Â  cell.style.fontSize = "0.8rem";
Â  Â  Â  Â  Â  Â  Â  Â  cell.textContent = "(Zone d'aperÃ§u - Importez un fichier)";
Â  Â  Â  Â  Â  Â  Â  Â  targetContainer.appendChild(cell);
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }


Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const type = refs.codeType.value;
Â  Â  Â  Â  Â  Â  Â  Â  let element;

Â  Â  Â  Â  Â  Â  Â  Â  if (type === 'QRCODE') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  element = document.createElement('canvas');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  QRCode.toCanvas(element, String(text), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  margin: 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 100 * scale
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  element = document.createElementNS("http://www.w3.org/2000/svg", "svg");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Correction EAN13 check digit
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let codeText = String(text);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (type === 'EAN13') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  codeText = codeText.replace(/\D/g, "");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (codeText.length === 12) codeText += calculCheckDigit(codeText);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  JsBarcode(element, codeText, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  format: type,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lineColor: "#000",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 2 * scale,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  height: 50 * scale,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayValue: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  margin: 5
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  cell.appendChild(element);
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  cell.textContent = `Erreur: ${e.message.substring(0, 30)}...`;
Â  Â  Â  Â  Â  Â  Â  Â  cell.style.color = "red";
Â  Â  Â  Â  Â  Â  Â  Â  cell.style.fontSize = "0.7rem";
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  targetContainer.appendChild(cell);
Â  Â  Â  Â  }

Â  Â  Â  Â  function calculCheckDigit(ean12) {
Â  Â  Â  Â  Â  Â  let sum = 0;
Â  Â  Â  Â  Â  Â  for (let i = 0; i < 12; i++) sum += (i % 2 === 0 ? 1 : 3) * parseInt(ean12[i]);
Â  Â  Â  Â  Â  Â  const rem = sum % 10;
Â  Â  Â  Â  Â  Â  return rem === 0 ? 0 : 10 - rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- IMPORT EXCEL ---
Â  Â  Â  Â  function handleFile(e) {
Â  Â  Â  Â  Â  Â  const file = e.target.files[0];
Â  Â  Â  Â  Â  Â  if (!file) return;

Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  reader.onload = function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  const data = e.target.result;
Â  Â  Â  Â  Â  Â  Â  Â  const workbook = XLSX.read(data, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'binary'
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  const sheet = workbook.Sheets[workbook.SheetNames[0]];
Â  Â  Â  Â  Â  Â  Â  Â  const json = XLSX.utils.sheet_to_json(sheet, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  header: 1
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  // Filtre colonne A
Â  Â  Â  Â  Â  Â  Â  Â  appData = json.map(r => r[0]).filter(c => c !== undefined && c !== "");

Â  Â  Â  Â  Â  Â  Â  Â  // UI Update
Â  Â  Â  Â  Â  Â  Â  Â  refs.importStatus.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  refs.importCount.textContent = `${appData.length} codes chargÃ©s`;
Â  Â  Â  Â  Â  Â  Â  Â  refs.clearBtn.style.display = 'inline-flex';

Â  Â  Â  Â  Â  Â  Â  Â  renderBarcodes();
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  reader.readAsBinaryString(file);
Â  Â  Â  Â  }

Â  Â  Â  Â  refs.excelInput.addEventListener('change', handleFile);

Â  Â  Â  Â  // Drop Zone handling
Â  Â  Â  Â  refs.dropZone.addEventListener('dragover', (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  refs.dropZone.style.borderColor = 'var(--primary)';
Â  Â  Â  Â  });

Â  Â  Â  Â  refs.dropZone.addEventListener('dragleave', (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  refs.dropZone.style.borderColor = 'var(--border-subtle)';
Â  Â  Â  Â  });

Â  Â  Â  Â  refs.dropZone.addEventListener('drop', (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  refs.dropZone.style.borderColor = 'var(--border-subtle)';
Â  Â  Â  Â  Â  Â  if (e.dataTransfer.files.length) {
Â  Â  Â  Â  Â  Â  Â  Â  refs.excelInput.files = e.dataTransfer.files;
Â  Â  Â  Â  Â  Â  Â  Â  handleFile({ target: refs.excelInput });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // Clear
Â  Â  Â  Â  refs.clearBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  appData = [];
Â  Â  Â  Â  Â  Â  refs.importStatus.style.display = 'none';
Â  Â  Â  Â  Â  Â  refs.clearBtn.style.display = 'none';
Â  Â  Â  Â  Â  Â  refs.excelInput.value = "";
Â  Â  Â  Â  Â  Â  renderBarcodes();
Â  Â  Â  Â  });

Â  Â  Â  Â  // Download PNG
        // NOTE: Le tÃ©lÃ©chargement PNG ne capturera que la PREMIÃˆRE page
Â  Â  Â  Â  refs.downloadBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  // Cible la premiÃ¨re feuille pour la capture
Â  Â  Â  Â  Â  Â  const firstSheet = refs.sheetLayer.querySelector('.sheet');
Â  Â  Â  Â  Â  Â  if (!firstSheet) return;

Â  Â  Â  Â  Â  Â  const originalTransform = refs.sheetLayer.style.transform;
Â  Â  Â  Â  Â  Â  refs.sheetLayer.style.transform = "scale(1)";
Â  Â  Â  Â  Â  Â  refs.sheetLayer.style.boxShadow = "none";

Â  Â  Â  Â  Â  Â  html2canvas(firstSheet, { // Capture la premiÃ¨re feuille
Â  Â  Â  Â  Â  Â  Â  Â  scale: 3, 
Â  Â  Â  Â  Â  Â  Â  Â  useCORS: true
Â  Â  Â  Â  Â  Â  }).then(canvas => {
Â  Â  Â  Â  Â  Â  Â  Â  const a = document.createElement('a');
Â  Â  Â  Â  Â  Â  Â  Â  a.download = 'planche_etiquettes_page_1.png';
Â  Â  Â  Â  Â  Â  Â  Â  a.href = canvas.toDataURL('image/png');
Â  Â  Â  Â  Â  Â  Â  Â  a.click();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Restauration de l'affichage
Â  Â  Â  Â  Â  Â  Â  Â  refs.sheetLayer.style.transform = originalTransform;Â 
Â  Â  Â  Â  Â  Â  Â  Â  refs.sheetLayer.style.boxShadow = '0 20px 50px rgba(0,0,0,0.5)';
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });


Â  Â  Â  Â  // Init
Â  Â  Â  Â  populatePresets();
Â  Â  </script>
</body>

</html>
